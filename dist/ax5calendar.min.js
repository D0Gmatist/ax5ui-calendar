!function(t,e){var a=ax5.util,i=function(){var t,i=this,n=1;this.main=function(){e&&e.call(this),this.config={clickEventName:"click",theme:"default",mode:"day",dateFormat:"yyyy-mm-dd",displayDate:new Date,animateTime:250,dimensions:{controlHeight:"40px",controlButtonWidth:"40px",itemPadding:2},lang:{yearHeading:"Choose the year",monthHeading:"Choose the month",year:"%s",month:["January","February","March","April","May","June","July","August","September","October","November","December"],day:"%s"},multipleSelect:!1}}.apply(this,arguments),this.target=null,this.selection=[],t=this.config,this.printedDay={start:"",end:""},this.init=function(){t.target||console.log(ax5.info.getError("ax5calendar","401","setConfig")),this.target=jQuery(t.target),t.displayDate=a.date(t.displayDate),this.target.html(this.getFrame()),this.$={root:this.target.find('[data-calendar-els="root"]'),control:this.target.find('[data-calendar-els="control"]'),"control-display":this.target.find('[data-calendar-els="control-display"]'),body:this.target.find('[data-calendar-els="body"]')},t.control&&this.$.control.find("[data-calendar-move]").on(t.clickEventName,function(t){this.move(t||window.event)}.bind(this)),"day"===t.mode||"d"===t.mode?this.printDay(t.displayDate):"month"===t.mode||"m"===t.mode?this.printMonth(t.displayDate):("year"===t.mode||"y"===t.mode)&&this.printYear(t.displayDate)},this.getFrame=function(){var e=[];if(e.push('<div class="ax5-ui-calendar '+t.theme+'" data-calendar-els="root" onselectstart="return false;">'),t.control){var i={},n={};n.height=i.height=a.cssNumber(t.dimensions.controlHeight),n["line-height"]=i["line-height"]=a.cssNumber(t.dimensions.controlHeight),n.width=a.cssNumber(t.dimensions.controlHeight),e.push('<div class="calendar-control" data-calendar-els="control" style="'+a.css(i)+'">'),e.push('<a class="date-move-left" data-calendar-move="left" style="'+a.css(n)+'">'+t.control.left+"</a>"),e.push('<div class="date-display" data-calendar-els="control-display" style="'+a.css(i)+'"></div>'),e.push('<a class="date-move-right" data-calendar-move="right" style="'+a.css(n)+'">'+t.control.right+"</a>"),e.push("</div>")}return e.push('<div class="calendar-body" data-calendar-els="body"></div>'),e.push("</div>"),e.join("")},this.setDisplay=function(){if(t.control){var e=a.date(t.displayDate),i="",n="";if("day"==t.mode||"d"==t.mode)t.control.yearTmpl&&(i=t.control.yearTmpl.replace("%s",e.getFullYear())),t.control.monthTmpl&&(n=t.control.monthTmpl.replace("%s",t.lang.month[e.getMonth()])),this.$["control-display"].html(function(){return t.control.yearFirst?'<span data-calendar-display="year">'+i+'</span><span data-calendar-display="month">'+n+"</span>":'<span data-calendar-display="month">'+n+'</span><span data-calendar-display="year">'+i+"</span>"}());else if("month"==t.mode||"m"==t.mode)t.control.yearTmpl&&(i=t.control.yearTmpl.replace("%s",e.getFullYear())),this.$["control-display"].html('<span data-calendar-display="year">'+i+"</span>");else if("year"==t.mode||"y"==t.mode){var d=t.control.yearTmpl.replace("%s",e.getFullYear()-10),s=t.control.yearTmpl.replace("%s",Number(e.getFullYear())+9);this.$["control-display"].html(d+" ~ "+s)}this.$["control-display"].find("[data-calendar-display]").on(t.clickEventName,function(t){if(target=a.findParentNode(t.target,function(t){return t.getAttribute("data-calendar-display")?!0:void 0}),target){var e=target.getAttribute("data-calendar-display");this.changeMode(e)}}.bind(this))}},this.printDay=function(e){var n,d,s,l=a.date(e),r=[],o=new Date(l.getFullYear(),l.getMonth(),1,12),h=t.displayDate,c=function(){var t=o.getDay();return 0==t&&(t=7),a.date(o,{add:{d:-t}})}(),p=l.getMonth(),u=(l.getDate(),{}),m=this.$.body.width(),y=Math.floor(m*(6/7));for(t.dimensions.height&&(y=a.number(t.dimensions.height)),u.height=Math.floor(y/6)-2*a.number(t.dimensions.itemPadding)+"px",u["line-height"]=u.height,u.padding=a.cssNumber(t.dimensions.itemPadding),r.push('<table data-calendar-table="day" cellpadding="0" cellspacing="0" style="width:100%;">'),r.push("<thead>"),r.push("<tr>"),s=0;7>s;)r.push('<td class="calendar-col-'+s+'">'),r.push(ax5.info.weekNames[s].label),r.push("</td>"),s++;for(r.push("</tr>"),r.push("</thead>"),r.push("<tbody>"),n=c,d=0;6>d;){for(r.push("<tr>"),s=0;7>s;)r.push('<td class="calendar-col-'+s+'" style="'+a.css(u)+'">'),r.push('<a class="calendar-item-day '+function(){return t.selectable?t.selectable[a.date(n,{"return":"yyyy-mm-dd"})]?n.getMonth()==p?"live":"":"disable":n.getMonth()==p?a.date(n,{"return":"yyyymmdd"})==a.date(h,{"return":"yyyymmdd"})?"focus":"live":""}()+" "+function(){return""}()+'" data-calendar-item-date="'+a.date(n,{"return":t.dateFormat})+'"><span class="addon"></span>'+t.lang.day.replace("%s",n.getDate())+'<span class="lunar"></span></a>'),r.push("</td>"),s++,n=a.date(n,{add:{d:1}});r.push("</tr>"),d++}if(r.push("</tbody>"),r.push("</table>"),this.$.body.html(r.join("")),this.$.body.find("[data-calendar-item-date]").on(t.clickEventName,function(t){t=t||window.event,i.onclick(t);try{t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0}catch(t){}return!1}),this.printedDay={start:c,end:n},t.onStateChanged){var g={action:"printDay",printedDay:this.printedDay};t.onStateChanged.call(g,g)}this.setDisplay()},this.printMonth=function(e){var n,d,s,l=a.date(e),r=l.getMonth(),o=[],h={},c=this.$.body.width(),p=Math.floor(c*(6/7));for(t.dimensions.height&&(p=a.number(t.dimensions.height)),h.height=Math.floor(p/4)-2*a.number(t.dimensions.itemPadding)+"px",h["line-height"]=h.height,h.padding=a.cssNumber(t.dimensions.itemPadding),o.push('<table data-calendar-table="month" cellpadding="0" cellspacing="0" style="width:100%;">'),o.push("<thead>"),o.push("<tr>"),o.push('<td class="calendar-col-0" colspan="3">'+t.lang.monthHeading+"</td>"),o.push("</tr>"),o.push("</thead>"),o.push("<tbody>"),s=0,n=0;4>n;){for(o.push("<tr>"),d=0;3>d;)o.push('<td class="calendar-col-'+n+'" style="'+a.css(h)+'">'),o.push('<a class="calendar-item-month live '+function(){return s==r?"hover":""}()+'" data-calendar-item-month="'+function(){return l.getFullYear()+"-"+a.setDigit(s+1,2)+"-"+a.setDigit(l.getDate(),2)}()+'">'+t.lang.month[s]+"</a>"),o.push("</td>"),s++,d++;o.push("</tr>"),n++}o.push("</tbody>"),o.push("</table>"),this.$.body.html(o.join("")),this.$.body.find("[data-calendar-item-month]").on(t.clickEventName,function(t){if(t=t||window.event,target=a.findParentNode(t.target,function(t){return t.getAttribute("data-calendar-item-month")?!0:void 0}),target){value=target.getAttribute("data-calendar-item-month"),i.changeMode("day",value);try{t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0}catch(t){}return!1}}),this.setDisplay()},this.printYear=function(e){var n,d,s=a.date(e),l=s.getFullYear(),r=[],o={},h=this.$.body.width(),c=Math.floor(h*(6/7));for(t.dimensions.height&&(c=a.number(t.dimensions.height)),o.height=Math.floor(c/5)-2*a.number(t.dimensions.itemPadding)+"px",o["line-height"]=o.height,o.padding=a.cssNumber(t.dimensions.itemPadding),r.push('<table data-calendar-table="year" cellpadding="0" cellspacing="0" style="width:100%;">'),r.push("<thead>"),r.push("<tr>"),r.push('<td class="calendar-col-0" colspan="4">'+t.lang.yearHeading+"</td>"),r.push("</tr>"),r.push("</thead>"),r.push("<tbody>"),y=l-10,n=0;5>n;){for(r.push("<tr>"),d=0;4>d;)r.push('<td class="calendar-col-'+n+'" style="'+a.css(o)+'">'),r.push('<a class="calendar-item-year live '+function(){return y==l?"hover":""}()+'" data-calendar-item-year="'+function(){return y+"-"+a.setDigit(s.getMonth()+1,2)+"-"+a.setDigit(s.getDate(),2)}()+'">'+t.lang.year.replace("%s",y)+"</a>"),r.push("</td>"),y++,d++;r.push("</tr>"),n++}r.push("</tbody>"),r.push("</table>"),this.$.body.html(r.join("")),this.$.body.find("[data-calendar-item-year]").on(t.clickEventName,function(t){if(t=t||window.event,target=a.findParentNode(t.target,function(t){return t.getAttribute("data-calendar-item-year")?!0:void 0}),target){value=target.getAttribute("data-calendar-item-year"),i.changeMode("month",value);try{t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0}catch(t){}return!1}}),this.setDisplay()},this.onclick=function(e,d,s){if(d=a.findParentNode(e.target,function(t){return t.getAttribute("data-calendar-item-date")?!0:void 0})){s=d.getAttribute("data-calendar-item-date");var l=a.date(s,{"return":t.dateFormat}),r=!0;if(t.selectable&&(t.selectable[l]||(r=!1)),r){if(n=t.multipleSelect?a.isNumber(t.multipleSelect)?t.multipleSelect:2:1,i.selection.length>=n){var o=i.selection.splice(0,i.selection.length-(n-1));o.forEach(function(e){i.$.body.find('[data-calendar-item-date="'+a.date(e,{"return":t.dateFormat})+'"]').removeClass("selected")})}jQuery(d).addClass("selected"),i.selection.push(s),t.onClick&&t.onClick.call({date:s,target:this.target,dateElement:d})}}},this.move=function(e,i,n){i=a.findParentNode(e.target,function(t){return t.getAttribute("data-calendar-move")?!0:void 0}),i&&(n=i.getAttribute("data-calendar-move"),"day"==t.mode?("left"==n?t.displayDate=a.date(t.displayDate,{add:{m:-1}}):t.displayDate=a.date(t.displayDate,{add:{m:1}}),this.printDay(t.displayDate)):"month"==t.mode?("left"==n?t.displayDate=a.date(t.displayDate,{add:{y:-1}}):t.displayDate=a.date(t.displayDate,{add:{y:1}}),this.printMonth(t.displayDate)):"year"==t.mode&&("left"==n?t.displayDate=a.date(t.displayDate,{add:{y:-10}}):t.displayDate=a.date(t.displayDate,{add:{y:10}}),this.printYear(t.displayDate)))},this.changeMode=function(e,a){"undefined"!=typeof a&&(t.displayDate=a),t.mode=e,this.$.body.removeClass("fadein").addClass("fadeout"),setTimeout(function(){"day"==t.mode?this.printDay(t.displayDate):"month"==t.mode?this.printMonth(t.displayDate):"year"==t.mode&&this.printYear(t.displayDate),this.$.body.removeClass("fadeout").addClass("fadein")}.bind(this),t.animateTime)},this.setDisplayDate=function(e){t.displayDate=a.date(e),this.$.body.removeClass("fadein").addClass("fadeout"),setTimeout(function(){"day"==t.mode?this.printDay(t.displayDate):"month"==t.mode?this.printMonth(t.displayDate):"year"==t.mode&&this.printYear(t.displayDate),this.$.body.removeClass("fadeout").addClass("fadein")}.bind(this),t.animateTime)},this.setSelection=function(e){return a.isArray(e)?(n=t.multipleSelect?a.isNumber(t.multipleSelect)?t.multipleSelect:2:1,this.selection=e.splice(0,n),this.selection.forEach(function(e){i.$.body.find('[data-calendar-item-date="'+a.date(e,{"return":t.dateFormat})+'"]').addClass("selected")}),this):this},this.getSelection=function(){return this.selection}};a.isFunction(e)&&(i.prototype=new e),t.calendar=i}(ax5.ui,ax5.ui.root);